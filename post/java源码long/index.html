<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>[Java源码]Long - Blog - renyijiu</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="renyijiu" /><meta name="description" content="Java源码 - Long" /><meta name="keywords" content="Java, Java源码, Long" />






<meta name="generator" content="Hugo 0.64.1 with theme even" />


<link rel="canonical" href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81long/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="https://blog.renyijiu.com/sass/main.min.ed43bbebd8f9e28be587dd4008838633e46586c59f19a63b5540c6a163e7a59a.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="[Java源码]Long" />
<meta property="og:description" content="Java源码 - Long" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81long/" />
<meta property="article:published_time" content="2019-09-30T15:06:52+08:00" />
<meta property="article:modified_time" content="2019-09-30T15:06:52+08:00" />
<meta itemprop="name" content="[Java源码]Long">
<meta itemprop="description" content="Java源码 - Long">
<meta itemprop="datePublished" content="2019-09-30T15:06:52&#43;08:00" />
<meta itemprop="dateModified" content="2019-09-30T15:06:52&#43;08:00" />
<meta itemprop="wordCount" content="5654">



<meta itemprop="keywords" content="Java源码,Long," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[Java源码]Long"/>
<meta name="twitter:description" content="Java源码 - Long"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Renyijiu</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Renyijiu</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">About</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">[Java源码]Long</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-09-30 </span>
        <div class="post-category">
            <a href="/categories/java%E6%BA%90%E7%A0%81/"> Java源码 </a>
            </div>
        
      </div>
    </header>

    
    <div class="post-content">
      <p>这次来看看<code>Long</code>的源代码，基于 <em>jdk1.8.0_181.jdk</em> 版本，如有错误，欢迎联系指出。</p>
<h2 id="前言">前言</h2>
<p><code>Long</code>是<code>long</code>基础数据类型的包装类，从源码的角度来看，整体的思路和<code>Integer</code>是极其相似的，如果没有看过<code>Integer</code>的源代码，建议可以看看 <a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81integer/"> Java源码 - Integer </a> 这篇文章，相关的思路已经说明清楚。这篇文章相似逻辑会引用原有的逻辑说明，不会再重复介绍了。</p>
<h2 id="类定义">类定义</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Long</span> <span class="kd">extends</span> <span class="n">Number</span> <span class="kd">implements</span> <span class="n">Comparable</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>带有<code>final</code>标识，也就是说<strong>不可继承的</strong>。另外继承了<code>Number</code>类，而<code>Number</code>类实现了<code>Serializable</code>接口，所以<code>Long</code>也是可以序列化的；实现了<code>Comparable</code>接口。</p>
<h2 id="属性">属性</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Native</span> <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">MIN_VALUE</span> <span class="o">=</span> <span class="n">0x8000000000000000L</span><span class="o">;</span>

<span class="nd">@Native</span> <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">MAX_VALUE</span> <span class="o">=</span> <span class="n">0x7fffffffffffffffL</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li><code>MIN_VALUE</code> 表示了<code>Long</code>最小值，对应为<code>-2^63</code></li>
<li><code>MAX_VALUE</code> 表示了<code>Lone</code>最大值，对应为<code>2^63 - 1</code></li>
</ul>
<p>这里的两个常量都带有<code>@Native</code>注解，表示这两个常量值字段可以被native代码引用。当native代码和Java代码都需要维护相同的变量时，如果Java代码使用了<code>@Native</code>标记常量字段时，编译时可以生成对应的native代码的头文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Class</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="n">TYPE</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="o">)</span> <span class="n">Class</span><span class="o">.</span><span class="na">getPrimitiveClass</span><span class="o">(</span><span class="s">&#34;long&#34;</span><span class="o">)</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>获取类信息，<code>Long.TYPE == long.class</code>两者是等价的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Native</span> <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">SIZE</span> <span class="o">=</span> <span class="n">64</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>表示了<code>Long</code>的bit数，64位。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">BYTES</span> <span class="o">=</span> <span class="n">SIZE</span> <span class="o">/</span> <span class="n">Byte</span><span class="o">.</span><span class="na">SIZE</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>表示了<code>Long</code>的字节数，计算值固定为8</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">value</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>Long</code>是<code>long</code>的包装类，这里存放了<code>long</code>类型对应的数据值信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Native</span> <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="n">4290774380558885855L</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="内部类">内部类</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">LongCache</span> <span class="o">{</span>
  <span class="kd">private</span> <span class="nf">LongCache</span><span class="o">(</span><span class="o">)</span><span class="o">{</span><span class="o">}</span>

  <span class="kd">static</span> <span class="kd">final</span> <span class="n">Long</span> <span class="n">cache</span><span class="o">[</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Long</span><span class="o">[</span><span class="o">-</span><span class="o">(</span><span class="o">-</span><span class="n">128</span><span class="o">)</span> <span class="o">+</span> <span class="n">127</span> <span class="o">+</span> <span class="n">1</span><span class="o">]</span><span class="o">;</span>

  <span class="kd">static</span> <span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cache</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="o">)</span>
      <span class="n">cache</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">128</span><span class="o">)</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>LongCache</code>是<code>Long</code>的静态内部类，内部定义了一个长度为<code>128+127+1=256</code>的数组，用于缓存常用的数字范围，避免后续使用时重新进行实例化，提升性能。</p>
<h2 id="方法">方法</h2>
<h3 id="构造方法">构造方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">Long</span><span class="o">(</span><span class="kt">long</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="nf">Long</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span> <span class="o">{</span>
  <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">parseLong</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">10</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>存在两个构造函数，支持传入<code>long</code>和<code>String</code>类型参数。但参数类型为<code>String</code>时，内部以十进制格式调用了<code>parseLong</code>方法进行处理实现。</p>
<h3 id="parselong-方法">parseLong 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">parseLong</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">parseLong</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">radix</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span>
</code></pre></td></tr></table>
</div>
</div><p>存在两个<code>parseLong</code>方法，具体逻辑和<code>Integer</code>的<code>parseInt</code>类似，可以参考相关的文章介绍<a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81integer/#parseint-%E6%96%B9%E6%B3%95">parseInt 方法</a></p>
<h3 id="parseunsignedlong-方法">parseUnsignedLong 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">parseUnsignedLong</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">parseUnsignedLong</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">10</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">parseUnsignedLong</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">radix</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span>
</code></pre></td></tr></table>
</div>
</div><p>存在两个<code>parseUnsignedLong</code>方法，第一个方法内部默认以十进制调用了第二个方法进行实现，方法的整体逻辑与<code>Integer</code>的<code>parseUnsignedInt</code>基本一致，可以参考 <a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81integer/#parseunsignedint-%E6%96%B9%E6%B3%95">parseUnsignedInt 方法</a></p>
<h3 id="getchars-方法">getChars 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kt">void</span> <span class="nf">getChars</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">index</span><span class="o">,</span> <span class="kt">char</span><span class="o">[</span><span class="o">]</span> <span class="n">buf</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>该方法主要的逻辑就是将输入<code>long</code>类型数据转换成字符形式放入char数组中，<strong>不支持 Long.MIN_VALUE</strong>。具体逻辑说明可以参考<code>Integer</code>的<a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81integer/#getchars-%E6%96%B9%E6%B3%95">getChars 方法</a></p>
<h3 id="stringsize-方法">stringSize 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kt">int</span> <span class="nf">stringSize</span><span class="o">(</span><span class="kt">long</span> <span class="n">x</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">long</span> <span class="n">p</span> <span class="o">=</span> <span class="n">10</span><span class="o">;</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="n">1</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">19</span><span class="o">;</span> <span class="n">i</span><span class="o">+</span><span class="o">+</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">p</span><span class="o">)</span>
      <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">10</span><span class="o">*</span><span class="n">p</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">19</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>获取对应数据的字符串长度，设定最大长度19进行循环判断（因为<code>Long.MAX_VALUE</code>转换成十进制数，最大长度为19位）；从逻辑可以看出，<strong>只支持正数</strong>，负数的结果是错误的。</p>
<h3 id="tostring-方法">toString 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">toString</span><span class="o">(</span><span class="n">value</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">radix</span><span class="o">)</span>
</code></pre></td></tr></table>
</div>
</div><p>存在三个<code>toString</code>方法，其中两个为静态方法，与<code>Integer</code>一致，可以参考<a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81integer/#tostring-%E6%96%B9%E6%B3%95">toString 方法</a></p>
<h3 id="tounsignedstring-方法">toUnsignedString 方法</h3>
<p><code>Integer</code>的<code>toUnsignedString</code>方法内部实现调用了<code>Long</code>的<code>toUnsignedString </code>方法进行实现，所以我们来看看这个方法的实现。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">toUnsignedString</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">radix</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span>
    <span class="k">return</span> <span class="n">toString</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">radix</span><span class="o">)</span><span class="o">;</span>
  <span class="k">else</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">radix</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">2</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">toBinaryString</span><span class="o">(</span><span class="n">i</span><span class="o">)</span><span class="o">;</span>

      <span class="k">case</span> <span class="n">4</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">toUnsignedString0</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">2</span><span class="o">)</span><span class="o">;</span>

      <span class="k">case</span> <span class="n">8</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">toOctalString</span><span class="o">(</span><span class="n">i</span><span class="o">)</span><span class="o">;</span>

      <span class="k">case</span> <span class="n">10</span><span class="o">:</span>
        <span class="cm">/*
</span><span class="cm">         * We can get the effect of an unsigned division by 10
</span><span class="cm">         * on a long value by first shifting right, yielding a
</span><span class="cm">         * positive value, and then dividing by 5.  This
</span><span class="cm">         * allows the last digit and preceding digits to be
</span><span class="cm">         * isolated more quickly than by an initial conversion
</span><span class="cm">         * to BigInteger.
</span><span class="cm">         */</span>
        <span class="kt">long</span> <span class="n">quot</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">1</span><span class="o">)</span> <span class="o">/</span> <span class="n">5</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">rem</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">quot</span> <span class="o">*</span> <span class="n">10</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">toString</span><span class="o">(</span><span class="n">quot</span><span class="o">)</span> <span class="o">+</span> <span class="n">rem</span><span class="o">;</span>

      <span class="k">case</span> <span class="n">16</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">toHexString</span><span class="o">(</span><span class="n">i</span><span class="o">)</span><span class="o">;</span>

      <span class="k">case</span> <span class="n">32</span><span class="o">:</span>
        <span class="k">return</span> <span class="n">toUnsignedString0</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">5</span><span class="o">)</span><span class="o">;</span>
<span class="nl">
</span><span class="nl">      default:</span>
        <span class="k">return</span> <span class="n">toUnsignedBigInteger</span><span class="o">(</span><span class="n">i</span><span class="o">)</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">radix</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>把<code>long</code>类型数值转换成对应的无符号字符串。因为<code>long</code>的最大值为<code>2^63 - 1</code>，正数的值转换成无符号数时依旧在这个范围内，所以直接调用<code>toString</code>方法实现。对于负数而言，根据进制的不一样，调用不同的方法进行处理。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">toHexString</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">toUnsignedString0</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">4</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">toOctalString</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">toUnsignedString0</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">3</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">toBinaryString</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">toUnsignedString0</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这三个方法的内部实现均是调用了<code>toUnsignedString0</code>方法，我们来看下<code>toUnsignedString0</code>的代码实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="n">String</span> <span class="nf">toUnsignedString0</span><span class="o">(</span><span class="kt">long</span> <span class="n">val</span><span class="o">,</span> <span class="kt">int</span> <span class="n">shift</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// assert shift &gt; 0 &amp;&amp; shift &lt;=5 : &#34;Illegal shift value&#34;;
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">SIZE</span> <span class="o">-</span> <span class="n">Long</span><span class="o">.</span><span class="na">numberOfLeadingZeros</span><span class="o">(</span><span class="n">val</span><span class="o">)</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="o">(</span><span class="o">(</span><span class="n">mag</span> <span class="o">+</span> <span class="o">(</span><span class="n">shift</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span><span class="o">)</span> <span class="o">/</span> <span class="n">shift</span><span class="o">)</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span><span class="o">;</span>
  <span class="kt">char</span><span class="o">[</span><span class="o">]</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">chars</span><span class="o">]</span><span class="o">;</span>

  <span class="n">formatUnsignedLong</span><span class="o">(</span><span class="n">val</span><span class="o">,</span> <span class="n">shift</span><span class="o">,</span> <span class="n">buf</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">chars</span><span class="o">)</span><span class="o">;</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">buf</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>我们来分析一下这几行代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">SIZE</span> <span class="o">-</span> <span class="n">Long</span><span class="o">.</span><span class="na">numberOfLeadingZeros</span><span class="o">(</span><span class="n">val</span><span class="o">)</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p><code>mag</code>表示了该数字表示为二进制实际需要的位数（去除高位的0）。<code>numberOfLeadingZeros</code>方法就是获取该数字二进制格式下最高位1前面的0的个数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">int</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="o">(</span><span class="o">(</span><span class="n">mag</span> <span class="o">+</span> <span class="o">(</span><span class="n">shift</span> <span class="o">-</span> <span class="n">1</span><span class="o">)</span><span class="o">)</span> <span class="o">/</span> <span class="n">shift</span><span class="o">)</span><span class="o">,</span> <span class="n">1</span><span class="o">)</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>根据<code>mag</code>和<code>shift</code>获取转换成对应进制的字符串所需的字符数（<code>shift</code>代表了进制数）。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">char</span><span class="o">[</span><span class="o">]</span> <span class="n">buf</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">chars</span><span class="o">]</span><span class="o">;</span>

<span class="n">formatUnsignedLong</span><span class="o">(</span><span class="n">val</span><span class="o">,</span> <span class="n">shift</span><span class="o">,</span> <span class="n">buf</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">chars</span><span class="o">)</span><span class="o">;</span>
</code></pre></td></tr></table>
</div>
</div><p>将转换的字符写入到<code>buf</code>数组中，来看下<code>formatUnsignedLong</code>方法实现。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="kt">int</span> <span class="nf">formatUnsignedLong</span><span class="o">(</span><span class="kt">long</span> <span class="n">val</span><span class="o">,</span> <span class="kt">int</span> <span class="n">shift</span><span class="o">,</span> <span class="kt">char</span><span class="o">[</span><span class="o">]</span> <span class="n">buf</span><span class="o">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">,</span> <span class="kt">int</span> <span class="n">len</span><span class="o">)</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">charPos</span> <span class="o">=</span> <span class="n">len</span><span class="o">;</span>
  <span class="c1">// 获取进制
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">radix</span> <span class="o">=</span> <span class="n">1</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">shift</span><span class="o">;</span> 
  <span class="c1">// 掩码，二进制都为1
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">radix</span> <span class="o">-</span> <span class="n">1</span><span class="o">;</span>
  <span class="k">do</span> <span class="o">{</span>
    <span class="c1">// 去除对应进制范围内的最后一位数，获取对应的字符
</span><span class="c1"></span>    <span class="n">buf</span><span class="o">[</span><span class="n">offset</span> <span class="o">+</span> <span class="o">-</span><span class="o">-</span><span class="n">charPos</span><span class="o">]</span> <span class="o">=</span> <span class="n">Integer</span><span class="o">.</span><span class="na">digits</span><span class="o">[</span><span class="o">(</span><span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">val</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="o">]</span><span class="o">;</span>
    <span class="c1">// 无符号右移，去除上一步已经处理的值
</span><span class="c1"></span>    <span class="n">val</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span><span class="o">=</span> <span class="n">shift</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">val</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span> <span class="o">&amp;</span><span class="o">&amp;</span> <span class="n">charPos</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span><span class="o">;</span>

  <span class="k">return</span> <span class="n">charPos</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>整体思路就是这样，这样就获取到了对应的字符数组，然后转换成字符串输出结果。</p>
<h3 id="tounsignedbiginteger-方法">toUnsignedBigInteger 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="n">BigInteger</span> <span class="nf">toUnsignedBigInteger</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">0L</span><span class="o">)</span>
    <span class="k">return</span> <span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">i</span><span class="o">)</span><span class="o">;</span>
  <span class="k">else</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">32</span><span class="o">)</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">lower</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">i</span><span class="o">;</span>

    <span class="c1">// return (upper &lt;&lt; 32) + lower
</span><span class="c1"></span>    <span class="k">return</span> <span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">toUnsignedLong</span><span class="o">(</span><span class="n">upper</span><span class="o">)</span><span class="o">)</span><span class="o">)</span><span class="o">.</span><span class="na">shiftLeft</span><span class="o">(</span><span class="n">32</span><span class="o">)</span><span class="o">.</span>
      <span class="n">add</span><span class="o">(</span><span class="n">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">toUnsignedLong</span><span class="o">(</span><span class="n">lower</span><span class="o">)</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>将<code>long</code>类型值转换成<code>BigInteger</code>类型值，当参数<code>&gt;=0</code>时，使用<code>BigInteger.valueOf(i)</code>方法处理返回结果；如果小于0，则先拆分按照高位4字节和低位4字节进行处理，然后获取结果。</p>
<h3 id="valueof-方法">valueOf 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Long</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">,</span> <span class="kt">int</span> <span class="n">radix</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">parseLong</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">radix</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">Long</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">parseLong</span><span class="o">(</span><span class="n">s</span><span class="o">,</span> <span class="n">10</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">Long</span> <span class="nf">valueOf</span><span class="o">(</span><span class="kt">long</span> <span class="n">l</span><span class="o">)</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">128</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">l</span> <span class="o">&gt;</span><span class="o">=</span> <span class="o">-</span><span class="n">128</span> <span class="o">&amp;</span><span class="o">&amp;</span> <span class="n">l</span> <span class="o">&lt;</span><span class="o">=</span> <span class="n">127</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// will cache
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">LongCache</span><span class="o">.</span><span class="na">cache</span><span class="o">[</span><span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">l</span> <span class="o">+</span> <span class="n">offset</span><span class="o">]</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">Long</span><span class="o">(</span><span class="n">l</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>存在三个<code>valueOf</code>方法，前两个内部实现均是调用了第三个方法。当参数在<code>-128~127</code>之间时，从<code>LongCache</code>的缓存数组中获取，否则重新实例化对象返回。所以可以看看下面的示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="n">Long</span> <span class="n">a</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">108</span><span class="o">)</span><span class="o">;</span>
<span class="n">Long</span> <span class="n">b</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">108</span><span class="o">)</span><span class="o">;</span>

<span class="n">Long</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">1108</span><span class="o">)</span><span class="o">;</span>
<span class="n">Long</span> <span class="n">d</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">1108</span><span class="o">)</span><span class="o">;</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span> <span class="o">=</span><span class="o">=</span> <span class="n">b</span><span class="o">)</span><span class="o">;</span> <span class="c1">// true
</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span> <span class="o">=</span><span class="o">=</span> <span class="n">d</span><span class="o">)</span><span class="o">;</span> <span class="c1">// false
</span></code></pre></td></tr></table>
</div>
</div><h3 id="decode-方法">decode 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Long</span> <span class="nf">decode</span><span class="o">(</span><span class="n">String</span> <span class="n">nm</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span>
</code></pre></td></tr></table>
</div>
</div><p>将对应的字符串转换成整数，支持十进制，<code>0x, 0X, #</code>开头的十六进制数，<code>0</code>开头的八进制数。代码逻辑解释可以参考 <a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81integer/#decode-%E6%96%B9%E6%B3%95">Integer 的 decode 方法</a></p>
<h3 id="getlong-方法">getLong 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Long</span> <span class="nf">getLong</span><span class="o">(</span><span class="n">String</span> <span class="n">nm</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">getLong</span><span class="o">(</span><span class="n">nm</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">Long</span> <span class="nf">getLong</span><span class="o">(</span><span class="n">String</span> <span class="n">nm</span><span class="o">,</span> <span class="kt">long</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">Long</span> <span class="n">result</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="n">nm</span><span class="o">,</span> <span class="kc">null</span><span class="o">)</span><span class="o">;</span>
  <span class="k">return</span> <span class="o">(</span><span class="n">result</span> <span class="o">=</span><span class="o">=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">val</span><span class="o">)</span> <span class="o">:</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="n">Long</span> <span class="nf">getLong</span><span class="o">(</span><span class="n">String</span> <span class="n">nm</span><span class="o">,</span> <span class="n">Long</span> <span class="n">val</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">{</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="n">nm</span><span class="o">)</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalArgumentException</span> <span class="o">|</span> <span class="n">NullPointerException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">v</span> <span class="o">!</span><span class="o">=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">v</span><span class="o">)</span><span class="o">;</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="n">val</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>三个<code>getLong</code>方法，主要是最后一个方法。传入一个配置的key以及默认值，获取对应的系统配置值，若为空或者为null，返回对应的默认值</p>
<h3 id="xxxvalue-方法">xxxValue 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">byte</span> <span class="nf">byteValue</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span><span class="n">value</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">short</span> <span class="nf">shortValue</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="kt">short</span><span class="o">)</span><span class="n">value</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">int</span> <span class="nf">intValue</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">value</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">long</span> <span class="nf">longValue</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">float</span> <span class="nf">floatValue</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">value</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">double</span> <span class="nf">doubleValue</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="kt">double</span><span class="o">)</span><span class="n">value</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>直接进行强制类型转换，返回对应的结果</p>
<h3 id="hashcode-方法">hashCode 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">value</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">(</span><span class="kt">long</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="o">(</span><span class="n">value</span> <span class="o">^</span> <span class="o">(</span><span class="n">value</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">32</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p><code>hashCode</code>返回<code>int</code>类型结果，首先将输入参数无符号右移32位，然后与原来的值进行异或运算，强制转换成<code>int</code>类型返回对应的结果。</p>
<h3 id="equals-方法">equals 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">Long</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">value</span> <span class="o">=</span><span class="o">=</span> <span class="o">(</span><span class="o">(</span><span class="n">Long</span><span class="o">)</span><span class="n">obj</span><span class="o">)</span><span class="o">.</span><span class="na">longValue</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>首先判断是不是<code>Long</code>对象的实例，然后比较两者的值是否相等；这里可以看出我们无需担心输入参数为<code>null</code>的时候会出现报错的情况。</p>
<h3 id="compare-方法">compare 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="kt">long</span> <span class="n">x</span><span class="o">,</span> <span class="kt">long</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">y</span><span class="o">)</span> <span class="o">?</span> <span class="o">-</span><span class="n">1</span> <span class="o">:</span> <span class="o">(</span><span class="o">(</span><span class="n">x</span> <span class="o">=</span><span class="o">=</span> <span class="n">y</span><span class="o">)</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">1</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>比较两个参数的值，三元表达式，<code>x &lt; y</code> 时返回<code>-1</code>，<code>x == y</code> 时返回<code>0</code>，<code>x &gt; y</code> 时返回<code>1</code></p>
<h3 id="compareto-方法">compareTo 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="n">Long</span> <span class="n">anotherLong</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">compare</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">value</span><span class="o">,</span> <span class="n">anotherLong</span><span class="o">.</span><span class="na">value</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>调用<code>compare</code>方法比较两个值，返回结果与<code>compare</code>方法一致</p>
<h3 id="compareunsigned-方法">compareUnsigned 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">compareUnsigned</span><span class="o">(</span><span class="kt">long</span> <span class="n">x</span><span class="o">,</span> <span class="kt">long</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">compare</span><span class="o">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">MIN_VALUE</span><span class="o">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">MIN_VALUE</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>两个输入参数当作无符号整数进行比较，这里通过加上<code>MIN_VALUE</code>确保在范围内。有个小技巧，-1加上<code>MIN_VALUE</code>后会变成最大正数。</p>
<h3 id="divideunsigned-方法">divideUnsigned 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">divideUnsigned</span><span class="o">(</span><span class="kt">long</span> <span class="n">dividend</span><span class="o">,</span> <span class="kt">long</span> <span class="n">divisor</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">divisor</span> <span class="o">&lt;</span> <span class="n">0L</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// signed comparison
</span><span class="c1"></span>    <span class="c1">// Answer must be 0 or 1 depending on relative magnitude
</span><span class="c1"></span>    <span class="c1">// of dividend and divisor.
</span><span class="c1"></span>    <span class="k">return</span> <span class="o">(</span><span class="n">compareUnsigned</span><span class="o">(</span><span class="n">dividend</span><span class="o">,</span> <span class="n">divisor</span><span class="o">)</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">0</span> <span class="o">?</span> <span class="n">0L</span> <span class="o">:</span><span class="n">1L</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">dividend</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="c1">//  Both inputs non-negative
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">dividend</span><span class="o">/</span><span class="n">divisor</span><span class="o">;</span>
  <span class="k">else</span> <span class="o">{</span>
    <span class="cm">/*
</span><span class="cm">    * For simple code, leveraging BigInteger.  Longer and faster
</span><span class="cm">    * code written directly in terms of operations on longs is
</span><span class="cm">    * possible; see &#34;Hacker&#39;s Delight&#34; for divide and remainder
</span><span class="cm">    * algorithms.
</span><span class="cm">    */</span>
    <span class="k">return</span> <span class="n">toUnsignedBigInteger</span><span class="o">(</span><span class="n">dividend</span><span class="o">)</span><span class="o">.</span>
      <span class="n">divide</span><span class="o">(</span><span class="n">toUnsignedBigInteger</span><span class="o">(</span><span class="n">divisor</span><span class="o">)</span><span class="o">)</span><span class="o">.</span><span class="na">longValue</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>无符号除法，输入参数转换成无符号数相除获取结果</p>
<ul>
<li>当除数小于0时，调用<code>compareUnsigned</code>比较除数和被除数，被除数 &lt; 除数时返回0，否则返回1（取决于被除数的正负性）</li>
<li>当除数和被除数均为正数值，直接使用除法运算获取结果</li>
<li>当被除数小于0，除数大于0时，使用<code>toUnsignedBigInteger</code>转换成无符号<code>BigInteger</code>进行运算获取对应的结果</li>
</ul>
<h3 id="remainderunsigned-方法">remainderUnsigned 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">remainderUnsigned</span><span class="o">(</span><span class="kt">long</span> <span class="n">dividend</span><span class="o">,</span> <span class="kt">long</span> <span class="n">divisor</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">dividend</span> <span class="o">&gt;</span> <span class="n">0</span> <span class="o">&amp;</span><span class="o">&amp;</span> <span class="n">divisor</span> <span class="o">&gt;</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// signed comparisons
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span><span class="o">;</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">compareUnsigned</span><span class="o">(</span><span class="n">dividend</span><span class="o">,</span> <span class="n">divisor</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">0</span><span class="o">)</span> <span class="c1">// Avoid explicit check for 0 divisor
</span><span class="c1"></span>      <span class="k">return</span> <span class="n">dividend</span><span class="o">;</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="n">toUnsignedBigInteger</span><span class="o">(</span><span class="n">dividend</span><span class="o">)</span><span class="o">.</span>
      <span class="n">remainder</span><span class="o">(</span><span class="n">toUnsignedBigInteger</span><span class="o">(</span><span class="n">divisor</span><span class="o">)</span><span class="o">)</span><span class="o">.</span><span class="na">longValue</span><span class="o">(</span><span class="o">)</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>无符号取余，输入参数转换成无符号数进行取余获取结果。</p>
<ul>
<li>当除数和被除数均大于0时，直接进行取余运算获取结果</li>
<li>当转换成无符号数，除数小于被除数时，直接返回除数作为结果</li>
<li>否则使用<code>toUnsignedBigInteger</code>方法，两者均转换成无符号<code>BigInteger</code>进行运算获取对应的结果</li>
</ul>
<h3 id="highestonebit-方法">highestOneBit 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">highestOneBit</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// HD, Figure 3-1
</span><span class="c1"></span>  <span class="n">i</span> <span class="o">|</span><span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span>  <span class="n">1</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">|</span><span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span>  <span class="n">2</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">|</span><span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span>  <span class="n">4</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">|</span><span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span>  <span class="n">8</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">|</span><span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">16</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">|</span><span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">32</span><span class="o">)</span><span class="o">;</span>
  <span class="k">return</span> <span class="n">i</span> <span class="o">-</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">1</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>获取最高位为1，其余为0的<code>long</code>类型值。通过位移或逻辑，将最高位右边1位设为1，然后2倍增长左移或操作，1的位数不断增加，最后1+2+4+8+16+32=63，可以确保覆盖所有可能性。然后使用<code>i - (i &gt;&gt;&gt; 1)</code>保留最高位1返回结果。</p>
<h3 id="lowestonebit-方法">lowestOneBit 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">lowestOneBit</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// HD, Section 2-1
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">i</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>获取最低位1，其余位为0的值。负数以正数的补码表示，对整数的二进制进行取反码然后加1，得到的结果与输入二进制进行与操作，结果就是最低位1保留，其他位为0。</p>
<h3 id="numberofleadingzeros-方法">numberOfLeadingZeros 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">numberOfLeadingZeros</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// HD, Figure 5-6
</span><span class="c1"></span>  <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span>
    <span class="k">return</span> <span class="n">64</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">1</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">32</span><span class="o">)</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">+</span><span class="o">=</span> <span class="n">32</span><span class="o">;</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">i</span><span class="o">;</span> <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">16</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">+</span><span class="o">=</span> <span class="n">16</span><span class="o">;</span> <span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span><span class="o">=</span> <span class="n">16</span><span class="o">;</span> <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">24</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">+</span><span class="o">=</span>  <span class="n">8</span><span class="o">;</span> <span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span><span class="o">=</span>  <span class="n">8</span><span class="o">;</span> <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">28</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">+</span><span class="o">=</span>  <span class="n">4</span><span class="o">;</span> <span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span><span class="o">=</span>  <span class="n">4</span><span class="o">;</span> <span class="o">}</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">30</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">+</span><span class="o">=</span>  <span class="n">2</span><span class="o">;</span> <span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span><span class="o">=</span>  <span class="n">2</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">n</span> <span class="o">-</span><span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">31</span><span class="o">;</span>
  <span class="k">return</span> <span class="n">n</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>判断二进制格式下，最高位的1左边存在多少个0。这里使用了类似二分查找的思想，通过左右移位的操作一步步缩小1所在的bit位置范围，最后通过简单计算获取0的个数。开始增加了对特殊值0的判断。可以查看<a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81integer/#numberofleadingzeros-%E6%96%B9%E6%B3%95">numberOfLeadingZeros 方法</a>中的例子加深了解</p>
<h3 id="numberoftrailingzeros-方法">numberOfTrailingZeros 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">numberOfTrailingZeros</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// HD, Figure 5-14
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">;</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">=</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="k">return</span> <span class="n">64</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">63</span><span class="o">;</span>
  <span class="n">y</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">i</span><span class="o">;</span> <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span><span class="n">32</span><span class="o">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span> <span class="k">else</span> <span class="n">x</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="o">(</span><span class="n">i</span><span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span><span class="n">32</span><span class="o">)</span><span class="o">;</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span><span class="n">16</span><span class="o">;</span> <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span><span class="n">16</span><span class="o">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">8</span><span class="o">;</span> <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">8</span><span class="o">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">4</span><span class="o">;</span> <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">4</span><span class="o">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">2</span><span class="o">;</span> <span class="k">if</span> <span class="o">(</span><span class="n">y</span> <span class="o">!</span><span class="o">=</span> <span class="n">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">2</span><span class="o">;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span> <span class="o">}</span>
  <span class="k">return</span> <span class="n">n</span> <span class="o">-</span> <span class="o">(</span><span class="o">(</span><span class="n">x</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">1</span><span class="o">)</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">31</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>与上面的<code>numberOfLeadingZeros</code>方法对应，获取二进制格式下尾部的0的个数。</p>
<h3 id="bitcount-方法">bitCount 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">bitCount</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// HD, Figure 5-14
</span><span class="c1"></span>  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="o">(</span><span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">1</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0x5555555555555555L</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0x3333333333333333L</span><span class="o">)</span> <span class="o">+</span> <span class="o">(</span><span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">2</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0x3333333333333333L</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">4</span><span class="o">)</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0x0f0f0f0f0f0f0f0fL</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">8</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">16</span><span class="o">)</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">32</span><span class="o">)</span><span class="o">;</span>
  <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0x7f</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>统计二进制格式下1的数量。代码第一眼看着是懵的，都是位运算，实际里面实现的算法逻辑还是很巧妙的，着实佩服，这里就不介绍了，感兴趣的可以看下<a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81integer/#bitcount-%E6%96%B9%E6%B3%95">Integer 的 bitCount 方法</a>介绍，了解其中的运算逻辑</p>
<h3 id="rotatexxx-方法">rotateXXX 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">rotateLeft</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">distance</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">distance</span><span class="o">)</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">distance</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">rotateRight</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">,</span> <span class="kt">int</span> <span class="n">distance</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">distance</span><span class="o">)</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="o">-</span><span class="n">distance</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>旋转二进制，<code>rotateLeft</code>将特定位数的高位bit放置低位，返回对应的数值；<code>rotateRight</code>将特定位数的低位bit放置高位，返回对应的数值。当<code>distance</code>是负数的时候，<code>rotateLeft(val, -distance) == rotateRight(val, distance)</code>以及<code>rotateRight(val, -distance) == rotateLeft(val, distance)</code>。另外，当<code>distance</code>是64的任意倍数时，实际是没有效果的 ，相当于无操作。</p>
<p>这里需要说一下<code>(i &gt;&gt;&gt; -distance)</code>，<code>diatance</code>为正数时，右移一个负数逻辑相当于<code>i &gt;&gt;&gt; 64+(-distance)</code></p>
<h3 id="reverse-方法">reverse 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">reverse</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// HD, Figure 7-1
</span><span class="c1"></span>  <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0x5555555555555555L</span><span class="o">)</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">1</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">1</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0x5555555555555555L</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0x3333333333333333L</span><span class="o">)</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">2</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">2</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0x3333333333333333L</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0x0f0f0f0f0f0f0f0fL</span><span class="o">)</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">4</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">4</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0x0f0f0f0f0f0f0f0fL</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0x00ff00ff00ff00ffL</span><span class="o">)</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">8</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">8</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0x00ff00ff00ff00ffL</span><span class="o">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">48</span><span class="o">)</span> <span class="o">|</span> <span class="o">(</span><span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0xffff0000L</span><span class="o">)</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">16</span><span class="o">)</span> <span class="o">|</span>
    <span class="o">(</span><span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">16</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0xffff0000L</span><span class="o">)</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">48</span><span class="o">)</span><span class="o">;</span>
  <span class="k">return</span> <span class="n">i</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>看着是不是和<code>bitCount</code>有点类似，其实核心逻辑相似。先是交换相邻1位bit的顺序，再交换相邻2位bit顺序，再继续交换相邻4位bit顺序，然后交换相邻8位bit顺序，再交换中间32位bit的顺序，最后最高16位再和低16位进行交换就完成了整个过程，全程位运算甚是奇妙。</p>
<h3 id="signum-方法">signum 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">signum</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// HD, Section 2-7
</span><span class="c1"></span>  <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">63</span><span class="o">)</span> <span class="o">|</span> <span class="o">(</span><span class="o">-</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">63</span><span class="o">)</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>获取符号数，若为负数，返回-1；若为0则返回0；为正数，则返回1。</p>
<h3 id="reversebytes-方法">reverseBytes 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">reverseBytes</span><span class="o">(</span><span class="kt">long</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0x00ff00ff00ff00ffL</span><span class="o">)</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">8</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">8</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0x00ff00ff00ff00ffL</span><span class="o">;</span>
  <span class="k">return</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">48</span><span class="o">)</span> <span class="o">|</span> <span class="o">(</span><span class="o">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="n">0xffff0000L</span><span class="o">)</span> <span class="o">&lt;</span><span class="o">&lt;</span> <span class="n">16</span><span class="o">)</span> <span class="o">|</span>
    <span class="o">(</span><span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">16</span><span class="o">)</span> <span class="o">&amp;</span> <span class="n">0xffff0000L</span><span class="o">)</span> <span class="o">|</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span><span class="o">&gt;</span><span class="o">&gt;</span> <span class="n">48</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>按照输入参数二进制格式，以字节为单位进行翻转，返回对应的结果数值。</p>
<ul>
<li><code>(i &amp; 0x00ff00ff00ff00ffL) &lt;&lt; 8 | (i &gt;&gt;&gt; 8) &amp; 0x00ff00ff00ff00ffL</code>交换相邻字节顺序</li>
<li><code> (i &gt;&gt;&gt; 48) | (i &lt;&lt; 48)</code>交换最高16位和最低16位bit位置。</li>
<li><code>((i &gt;&gt;&gt; 16) &amp; 0xffff0000L) | ((i &amp; 0xffff0000L) &lt;&lt; 16)</code>交换中间32位bit位置</li>
</ul>
<h3 id="summaxmin-方法">sum、max、min 方法</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">sum</span><span class="o">(</span><span class="kt">long</span> <span class="n">a</span><span class="o">,</span> <span class="kt">long</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">max</span><span class="o">(</span><span class="kt">long</span> <span class="n">a</span><span class="o">,</span> <span class="kt">long</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">min</span><span class="o">(</span><span class="kt">long</span> <span class="n">a</span><span class="o">,</span> <span class="kt">long</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="n">Math</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这个就不说了，很简单的方法。</p>
<h2 id="特别说明">特别说明</h2>
<p>因为<code>long</code>是64bit，需要注意下<code>long</code>的原子性逻辑，这里是官方文档的具体说明<a href="https://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.7">Non-Atomic Treatment of <code>double</code>and <code>long</code></a>，相关解释说明可以参考 <a href="https://blog.renyijiu.com/post/java%E6%BA%90%E7%A0%81double/#%E7%89%B9%E5%88%AB%E8%AF%B4%E6%98%8E">double</a>文章中的详细说明。</p>
<h2 id="总结">总结</h2>
<p>总的代码逻辑来看，<code>Long</code>和<code>Integer</code>的方法基本一致，方法内的实现也基本一致，如果了解了<code>Integer</code>的相关逻辑，<code>Long</code>相关代码可以快速的过一下即可；另外值得注意的是<code>long</code>的原子性问题。</p>
    </div>

    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="/img/reward/wechat.png">
        <span>微信打赏</span>
      </label>
    <label class="qr-code-image" for="reward">
        <img class="image" src="/img/reward/alipay.png">
        <span>支付宝打赏</span>
      </label>
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/java%E6%BA%90%E7%A0%81/">Java源码</a>
          <a href="/tags/long/">Long</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/java%E6%BA%90%E7%A0%81character/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">[Java源码]Character</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/java%E6%BA%90%E7%A0%81short/">
            <span class="next-text nav-default">[Java源码]Short</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:me@renyijiu.com" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/renyijiu" class="iconfont icon-github" title="github"></a>
  <a href="https://blog.renyijiu.com/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2014 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Live For Dream, Dream For Love.</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="https://blog.renyijiu.com/js/main.4d21c1cefdf1cd0b77ef59bab2d1bbe3112fc9d6cc04710bb1f0b1fd7b891f11.js"></script>

<script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?e0abcfc0d888305fec49b5dffdb3b780";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>






</body>
</html>
